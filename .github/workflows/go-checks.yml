on: ["push", "pull_request"]

name: Go checks
jobs:
  go-mod-check:
    name: Check that go is tidy and vendored
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: 1.21

      - name: Check go.mod and go.sum tidiness
        run: |
          go mod tidy && go mod vendor
          if [ ! -z "$(git status --porcelain go.mod go.sum)" ]; then
            echo "Need to run 'go mod tidy && go mod vendor'";
            exit 1;
          fi

      - id: govulncheck
        uses: golang/govulncheck-action@v1
